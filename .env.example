# ============================================================================
# SIEM Anomaly Detector - Environment Variables
# ============================================================================
# INSTRUCCIONES:
# 1. Copiar este archivo a .env: cp .env.example .env
# 2. Cambiar valores sensibles (passwords, secret keys)
# 3. NUNCA commitear .env a git
# ============================================================================

# ============================================================================
# API CONFIGURATION
# ============================================================================
API_HOST=0.0.0.0
API_PORT=8000
LOG_LEVEL=INFO
# Options: DEBUG, INFO, WARNING, ERROR, CRITICAL

# ============================================================================
# SECURITY
# ============================================================================
# ⚠️ CAMBIAR EN PRODUCCIÓN
# Generar con: openssl rand -hex 32
SECRET_KEY=your-secret-key-change-in-production-openssl-rand-hex-32

# CORS Origins (separados por comas)
ALLOWED_HOSTS=localhost,127.0.0.1
CORS_ORIGINS=http://localhost:3000,http://localhost:8000

# JWT Configuration
JWT_ALGORITHM=HS256
JWT_EXPIRATION_MINUTES=60

# ============================================================================
# DATABASE (PostgreSQL)
# ============================================================================
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=siem_db
POSTGRES_USER=siem_user
POSTGRES_PASSWORD=changeme
# ⚠️ CAMBIAR EN PRODUCCIÓN: usar contraseña fuerte

# Connection Pool
POSTGRES_POOL_SIZE=20
POSTGRES_MAX_OVERFLOW=10
POSTGRES_POOL_TIMEOUT=30

# ============================================================================
# REDIS (Cache & Message Broker)
# ============================================================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=
# ⚠️ En producción, usar contraseña

# Connection Pool
REDIS_MAX_CONNECTIONS=50
REDIS_SOCKET_TIMEOUT=5
REDIS_SOCKET_CONNECT_TIMEOUT=5

# ============================================================================
# MACHINE LEARNING CONFIGURATION
# ============================================================================

# Isolation Forest
MODEL_CONTAMINATION=0.03
# Proporción esperada de anomalías (0.01 = 1%, 0.05 = 5%)

MODEL_N_ESTIMATORS=100
# Número de árboles en Isolation Forest

# DBSCAN
DBSCAN_EPS=1.5
DBSCAN_MIN_SAMPLES=50

# GMM
GMM_N_COMPONENTS=3
GMM_COVARIANCE_TYPE=full
# Options: full, tied, diag, spherical

# Ensemble Weights
ENSEMBLE_WEIGHTS=0.5,0.3,0.2
# Pesos para IF, DBSCAN, GMM (deben sumar 1.0)

# Retraining
MODEL_RETRAIN_INTERVAL_HOURS=24
MODEL_MIN_FEEDBACK_COUNT=100
# Re-entrenar cuando haya al menos X feedbacks

# Model Storage
MODEL_PATH=./models
MODEL_BACKUP_ENABLED=true
MODEL_BACKUP_RETENTION_DAYS=30

# ============================================================================
# FEATURE ENGINEERING
# ============================================================================

# Time Windows (en segundos)
FEATURE_WINDOW_SHORT=60
# Ventana corta (1 minuto) para tasas instantáneas

FEATURE_WINDOW_MEDIUM=3600
# Ventana media (1 hora) para tendencias

FEATURE_WINDOW_LONG=86400
# Ventana larga (24 horas) para baselines

# IP Geolocation
GEOIP_ENABLED=true
GEOIP_DATABASE_PATH=./data/GeoLite2-City.mmdb
# Descargar de: https://dev.maxmind.com/geoip/geolite2-free-geolocation-data

# Known IPs Whitelist (separadas por comas)
KNOWN_IPS_WHITELIST=127.0.0.1,192.168.1.1
KNOWN_COUNTRIES_WHITELIST=US,ES,FR,DE,GB

# ============================================================================
# ALERTING
# ============================================================================

# Thresholds
ALERT_THRESHOLD_HIGH=0.8
ALERT_THRESHOLD_MEDIUM=0.6
ALERT_THRESHOLD_LOW=0.4

# Slack Integration
SLACK_WEBHOOK_URL=
# Ejemplo: https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXX
SLACK_CHANNEL=#security-alerts
SLACK_USERNAME=SIEM Anomaly Detector

# Email (SMTP)
EMAIL_ENABLED=false
EMAIL_SMTP_HOST=smtp.gmail.com
EMAIL_SMTP_PORT=587
EMAIL_SMTP_USER=your-email@gmail.com
EMAIL_SMTP_PASSWORD=your-app-password
EMAIL_FROM=siem@example.com
EMAIL_RECIPIENTS=admin@example.com,security@example.com
# Separar múltiples emails con comas

# Webhook (custom)
WEBHOOK_ENABLED=false
WEBHOOK_URL=https://your-webhook-endpoint.com/alerts
WEBHOOK_SECRET=your-webhook-secret
WEBHOOK_TIMEOUT=10
# Timeout en segundos

# PagerDuty
PAGERDUTY_ENABLED=false
PAGERDUTY_INTEGRATION_KEY=your-integration-key

# Rate Limiting para alertas
ALERT_RATE_LIMIT_PER_HOUR=10
ALERT_COOLDOWN_MINUTES=5
# No enviar misma alerta si ya se envió en últimos X minutos

# ============================================================================
# LOG PARSING
# ============================================================================

# Supported Log Types
SUPPORTED_LOG_TYPES=syslog,nginx,auth,firewall

# Syslog
SYSLOG_UDP_ENABLED=true
SYSLOG_UDP_PORT=514
SYSLOG_TCP_ENABLED=false
SYSLOG_TCP_PORT=514

# File Watchers
FILE_WATCH_ENABLED=false
FILE_WATCH_PATHS=/var/log/auth.log,/var/log/syslog,/var/log/nginx/access.log
# Separar múltiples paths con comas

FILE_WATCH_POLL_INTERVAL=1
# Intervalo de polling en segundos

# Log Retention
LOG_RETENTION_DAYS=90
LOG_COMPRESSION_ENABLED=true

# ============================================================================
# MONITORING & METRICS
# ============================================================================

# Prometheus
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090
PROMETHEUS_SCRAPE_INTERVAL=15s

# Grafana
GRAFANA_USER=admin
GRAFANA_PASSWORD=admin
# ⚠️ CAMBIAR EN PRODUCCIÓN

# Health Check
HEALTH_CHECK_INTERVAL=30
HEALTH_CHECK_TIMEOUT=10

# Performance Monitoring
PERFORMANCE_LOGGING_ENABLED=true
SLOW_QUERY_THRESHOLD_MS=100
# Log queries que tomen más de X ms

# ============================================================================
# CELERY (Async Tasks)
# ============================================================================
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/0
CELERY_TASK_SERIALIZER=json
CELERY_RESULT_SERIALIZER=json
CELERY_ACCEPT_CONTENT=json
CELERY_TIMEZONE=UTC
CELERY_ENABLE_UTC=true

# Worker Configuration
CELERY_WORKER_CONCURRENCY=4
CELERY_WORKER_PREFETCH_MULTIPLIER=4
CELERY_WORKER_MAX_TASKS_PER_CHILD=1000

# Task Time Limits
CELERY_TASK_SOFT_TIME_LIMIT=300
# Soft limit: 5 minutos
CELERY_TASK_HARD_TIME_LIMIT=600
# Hard limit: 10 minutos

# Scheduled Tasks
CELERY_BEAT_SCHEDULE_ENABLED=true

# ============================================================================
# DEVELOPMENT SETTINGS
# ============================================================================

# Debug Mode
DEBUG=false
# ⚠️ NUNCA activar en producción

# Auto-reload
AUTO_RELOAD=false
# Solo para desarrollo con --reload

# Testing
TESTING=false
TEST_DATABASE_URL=postgresql://siem_user:changeme@localhost:5432/siem_test_db

# Redis Commander (development tool)
REDIS_COMMANDER_USER=admin
REDIS_COMMANDER_PASSWORD=admin

# ============================================================================
# PRODUCTION OPTIMIZATIONS
# ============================================================================

# Workers
UVICORN_WORKERS=4
# Número de workers de uvicorn (recomendado: 2 * CPU cores)

# Connection Limits
MAX_CONNECTIONS_PER_WORKER=1000
KEEPALIVE_TIMEOUT=65

# Timeouts
REQUEST_TIMEOUT=30
GRACEFUL_SHUTDOWN_TIMEOUT=10

# Caching
CACHE_ENABLED=true
CACHE_TTL_SECONDS=300
# TTL para cache de features/estadísticas

# Rate Limiting (API)
RATE_LIMIT_ENABLED=true
RATE_LIMIT_PER_MINUTE=60
RATE_LIMIT_PER_HOUR=1000

# ============================================================================
# LOGGING
# ============================================================================

# Log Level per Component
API_LOG_LEVEL=INFO
ML_LOG_LEVEL=INFO
DB_LOG_LEVEL=WARNING
PARSER_LOG_LEVEL=INFO

# Log Format
LOG_FORMAT=json
# Options: json, text

# Log Output
LOG_FILE_ENABLED=true
LOG_FILE_PATH=./logs/siem.log
LOG_FILE_MAX_SIZE_MB=100
LOG_FILE_BACKUP_COUNT=10

# Structured Logging Fields
LOG_INCLUDE_TIMESTAMP=true
LOG_INCLUDE_HOSTNAME=true
LOG_INCLUDE_PID=true
LOG_INCLUDE_REQUEST_ID=true

# ============================================================================
# BACKUP & DISASTER RECOVERY
# ============================================================================

# Database Backups
DB_BACKUP_ENABLED=false
DB_BACKUP_SCHEDULE=0 2 * * *
# Cron format: 2 AM daily
DB_BACKUP_PATH=./backups/db
DB_BACKUP_RETENTION_DAYS=30

# Model Backups
MODEL_BACKUP_SCHEDULE=0 3 * * *
# Cron format: 3 AM daily
MODEL_BACKUP_PATH=./backups/models

# ============================================================================
# EXTERNAL INTEGRATIONS
# ============================================================================

# Threat Intelligence Feeds
THREAT_INTEL_ENABLED=false
MISP_URL=https://your-misp-instance.com
MISP_API_KEY=your-misp-api-key
MISP_VERIFY_SSL=true

# AlienVault OTX
OTX_ENABLED=false
OTX_API_KEY=your-otx-api-key

# VirusTotal
VIRUSTOTAL_ENABLED=false
VIRUSTOTAL_API_KEY=your-virustotal-api-key

# ============================================================================
# COMPLIANCE & AUDITING
# ============================================================================

# Audit Logging
AUDIT_LOG_ENABLED=true
AUDIT_LOG_PATH=./logs/audit.log

# Data Retention (GDPR compliance)
DATA_RETENTION_POLICY_DAYS=365
ANONYMIZE_OLD_DATA=true

# Access Logs
ACCESS_LOG_ENABLED=true
ACCESS_LOG_PATH=./logs/access.log

# ============================================================================
# EXPERIMENTAL FEATURES (use with caution)
# ============================================================================

# Deep Learning (experimental)
DEEP_LEARNING_ENABLED=false
LSTM_MODEL_PATH=./models/lstm_detector.pth

# Auto-response (experimental)
AUTO_RESPONSE_ENABLED=false
AUTO_BLOCK_THRESHOLD=0.95
# Solo bloquear automáticamente si risk_score > 0.95

FIREWALL_API_URL=http://firewall-api.local/block
FIREWALL_API_KEY=your-firewall-api-key
